# =====================================================================
# KONFIGURACJA MYSQL/MARIADB DLA 50+ UŻYTKOWNIKÓW
# =====================================================================
# Umieść ten plik w katalogu my.ini/my.cnf lub dodaj do istniejącego pliku
# Lokalizacja na Windows: C:\ProgramData\MySQL\MySQL Server X.X\my.ini
# Lokalizacja na Linux: /etc/mysql/my.cnf lub /etc/my.cnf
#
# Po wprowadzeniu zmian: RESTART SERWERA MySQL/MariaDB!
# =====================================================================

[mysqld]

# =====================================================================
# 1. CONNECTION SETTINGS (50-100 użytkowników jednocześnie)
# =====================================================================
max_connections = 200                # Maksymalna liczba połączeń (50 użytkowników × 2-4 połączenia)
max_connect_errors = 100             # Liczba błędów przed blokowaniem hosta
connect_timeout = 10                 # Timeout przy łączeniu (sekundy)
wait_timeout = 600                   # 10 minut - timeout nieaktywnego połączenia
interactive_timeout = 600            # 10 minut - dla interaktywnych połączeń
net_read_timeout = 60                # Timeout czytania z sieci
net_write_timeout = 60               # Timeout pisania do sieci

# Thread cache dla wydajności
thread_cache_size = 50               # Cache dla wątków (unikaj tworzenia nowych)

# =====================================================================
# 2. MEMORY BUFFERS (dla wydajności - dostosuj do RAM serwera)
# =====================================================================
# UWAGA: Te wartości są dla serwera z 8-16GB RAM
# Jeśli masz mniej RAM, zmniejsz proporcjonalnie

# InnoDB Buffer Pool - NAJWAŻNIEJSZE!
innodb_buffer_pool_size = 4G         # 50-70% dostępnego RAM (tutaj 4GB)
innodb_buffer_pool_instances = 4     # Liczba instancji pool (1 na GB)

# Query cache (dla powtarzających się zapytań)
query_cache_type = 1                 # Włącz query cache
query_cache_size = 256M              # Rozmiar cache dla zapytań
query_cache_limit = 2M               # Max rozmiar pojedynczego wyniku

# Bufory na połączenie
join_buffer_size = 2M                # Buffer dla JOIN
sort_buffer_size = 2M                # Buffer dla sortowania
read_buffer_size = 1M                # Buffer do czytania
read_rnd_buffer_size = 1M            # Buffer dla losowych odczytów

# Table cache
table_open_cache = 4000              # Cache dla otwartych tabel
table_definition_cache = 2000        # Cache dla definicji tabel

# =====================================================================
# 3. INNODB SETTINGS (wydajność zapisu)
# =====================================================================
innodb_flush_log_at_trx_commit = 2   # 2 = szybsze zapisy, mniej bezpieczne (akceptowalne dla LAN)
                                     # 1 = najbezpieczniejsze (ACID), wolniejsze
innodb_log_file_size = 512M          # Rozmiar log file (większy = lepsza wydajność zapisu)
innodb_log_buffer_size = 16M         # Buffer dla logów transakcji
innodb_write_io_threads = 8          # Wątki do zapisu (4-8)
innodb_read_io_threads = 8           # Wątki do odczytu (4-8)
innodb_flush_method = O_DIRECT       # Linux: O_DIRECT, Windows: unbuffered
innodb_file_per_table = 1            # Osobny plik dla każdej tabeli

# Lock wait timeout
innodb_lock_wait_timeout = 120       # 2 minuty na lock

# =====================================================================
# 4. OPTYMALIZACJE DLA KONKURENCYJNOŚCI
# =====================================================================
# Zmniejszenie lock contention
low_priority_updates = 0             # Priorytet dla SELECT vs UPDATE
concurrent_insert = 2                # Dozwól concurrent INSERT
max_write_lock_count = 10            # Po ilu write lock dać pierwszeństwo read

# =====================================================================
# 5. CHARSET & COLLATION
# =====================================================================
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# =====================================================================
# 6. LOGOWANIE (włącz tylko do debugowania!)
# =====================================================================
# slow_query_log = 1                 # Loguj wolne zapytania
# slow_query_log_file = /var/log/mysql/slow-query.log
# long_query_time = 2                # Zapytania wolniejsze niż 2s
# log_queries_not_using_indexes = 1  # Loguj zapytania bez indeksów

# =====================================================================
# 7. BINARY LOGGING (opcjonalne - backup/replikacja)
# =====================================================================
# Jeśli nie używasz replikacji, możesz wyłączyć binary log dla wydajności
# skip-log-bin                       # Wyłącz binary logging
# binlog_cache_size = 32K            # Jeśli używasz, zwiększ cache

# =====================================================================
# WERYFIKACJA KONFIGURACJI
# =====================================================================
# Po restarcie sprawdź:
# SHOW VARIABLES LIKE 'max_connections';
# SHOW VARIABLES LIKE 'innodb_buffer_pool_size';
# SHOW STATUS LIKE 'Threads_connected';
# SHOW STATUS LIKE 'Max_used_connections';
